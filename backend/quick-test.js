// quick-test.js - UPDATED
const mongoose = require('mongoose');

const uri = "mongodb+srv://sameer_db_user:eK4RHOPS2Gu1Nv4W@quickchat-cluster-dev.gwsxzaq.mongodb.net/quickchat?retryWrites=true&w=majority";

async function test() {
  console.log("üîó Testing MongoDB connection...");
  console.log("URI (masked):", uri.replace(/\/\/[^:]+:[^@]+@/, '//***:***@'));
  
  try {
    // SIMPLER connection - remove deprecated options
    await mongoose.connect(uri);
    
    console.log("‚úÖ SUCCESS! Connected to MongoDB!");
    console.log("üìä Database:", mongoose.connection.name);
    console.log("üìç Host:", mongoose.connection.host);
    console.log("üîå Ready State:", mongoose.connection.readyState);
    
    // List collections
    const collections = await mongoose.connection.db.listCollections().toArray();
    console.log("\nüìÅ Collections:");
    if (collections.length > 0) {
      collections.forEach(col => console.log("  -", col.name));
    } else {
      console.log("  No collections yet (empty database)");
    }
    
    await mongoose.connection.close();
    console.log("\nüîå Connection closed.");
    
  } catch (error) {
    console.error("\n‚ùå CONNECTION FAILED!");
    console.error("Error name:", error.name);
    console.error("Error message:", error.message);
    
    if (error.name === 'MongoServerSelectionError') {
      console.log("\nüí° Possible issues:");
      console.log("1. Wrong username/password");
      console.log("2. IP not whitelisted (but you added it)");
      console.log("3. Network/firewall issue");
      console.log("4. Try removing '/quickchat' from URI");
    }
    
    if (error.message.includes('auth')) {
      console.log("\nüîë Authentication issue!");
      console.log("Double-check username: sameer_db_user");
      console.log("Double-check password: eK4RHOPS2Gu1Nv4W");
    }
  }
}

test();